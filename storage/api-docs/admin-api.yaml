openapi: 3.0.3
info:
  title: 'HEMIS University API - Master Documentation'
  description: "**HEMIS University Management System - Complete API**\n\nSingle Source of Truth for all API endpoints.\n\n## Authentication\n```\nPOST /api/v1/employee/auth/login\nPOST /api/v1/student/auth/login\nAuthorization: Bearer {token}\n```\n\n## Permission System\n\nHar bir endpoint quyidagi meta-data'ga ega:\n- **x-permissions**: Required permissions (any of these)\n- **x-roles**: Allowed roles (any of these)\n- **x-user-types**: User categories (employee, student, admin)\n\n## Base URL\n- Development: http://localhost:8000/api\n- Production: https://hemis.uz/api\n"
  version: 1.0.0
  contact:
    name: 'HEMIS Support'
    email: support@hemis.uz
servers:
  -
    url: 'http://localhost:8000/api'
    description: 'Development server'
  -
    url: 'https://hemis.uz/api'
    description: 'Production server'
tags:
  -
    name: Auth
    description: 'Authentication endpoints'
  -
    name: 'Teacher - Dashboard'
    description: "O'qituvchi dashboard"
  -
    name: 'Teacher - Schedule'
    description: 'Dars jadvali'
  -
    name: 'Teacher - Attendance'
    description: Davomat
  -
    name: 'Teacher - Grades'
    description: Baholar
  -
    name: 'Teacher - Subjects'
    description: Fanlar
  -
    name: 'Teacher - Students'
    description: Talabalar
  -
    name: 'Student - Dashboard'
    description: 'Talaba dashboard'
  -
    name: 'Student - Profile'
    description: "Shaxsiy ma'lumotlar"
  -
    name: 'Admin - Dashboard'
    description: 'Admin dashboard'
  -
    name: 'Admin - Users'
    description: Foydalanuvchilar
  -
    name: Integration
    description: 'Tashqi integratsiya'
security:
  -
    BearerAuth: {  }
paths:
  /v1/employee/auth/login:
    post:
      tags:
        - Auth
      summary: 'Employee login (Teachers, Admins, Staff)'
      x-permissions: {  }
      x-roles: {  }
      x-user-types:
        - public
      x-auth-required: false
      security: {  }
      operationId: employeeLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - login
                - password
              properties:
                login:
                  type: string
                  example: jora_kuvandikov
                password:
                  type: string
                  example: password
      responses:
        200:
          description: 'Muvaffaqiyatli login'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  data: { type: object, properties: { token: { type: string }, user: { type: object } } }
  /v1/student/auth/login:
    post:
      tags:
        - Auth
      summary: 'Student login'
      x-permissions: {  }
      x-roles: {  }
      x-user-types:
        - public
      x-auth-required: false
      security: {  }
      operationId: studentLogin
      responses:
        200:
          description: 'Muvaffaqiyatli login'
  /v1/teacher/dashboard:
    get:
      tags:
        - 'Teacher - Dashboard'
      summary: "O'qituvchi dashboard ma'lumotlari"
      description: "Asosiy dashboard sahifasi uchun barcha kerakli ma'lumotlar:\n- Bugungi darslar\n- Davomat qilinmagan darslar (oxirgi 30 kun)\n- Umumiy statistika\n"
      x-permissions:
        - teacher.dashboard.view
        - admin.teacher.view
        - dean.teacher.view
      x-roles:
        - teacher
        - senior_teacher
        - head_teacher
        - assistant_teacher
        - admin
        - dean
        - rector
      x-user-types:
        - employee
      operationId: getTeacherDashboard
      responses:
        200:
          description: 'Muvaffaqiyatli javob'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { $ref: '#/components/schemas/DashboardData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /v1/teacher/dashboard/activities:
    get:
      tags:
        - 'Teacher - Dashboard'
      summary: "So'nggi faoliyatlar"
      description: "O'qituvchining so'nggi faoliyatlari (davomat, baholar, topshiriqlar)"
      x-permissions:
        - teacher.dashboard.view
        - admin.teacher.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      parameters:
        -
          name: limit
          in: query
          description: 'Natijalar soni'
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
            example: 10
      responses:
        200:
          description: "So'nggi faoliyatlar"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { type: array, items: { $ref: '#/components/schemas/Activity' } }
              example:
                success: true
                data:
                  - { type: attendance, date: '2025-01-04T10:30:00Z', description: 'Davomat belgilandi - Matematika, 21-guruh', student: 'Aliyev Vali' }
                  - { type: grade, date: '2025-01-04T14:15:00Z', description: "Baho qo'yildi - Fizika (85 ball)", student: 'Karimov Aziz' }
                  - { type: assignment, date: '2025-01-03T16:45:00Z', description: 'Topshiriq yaratildi - Algebra', student: null }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /v1/teacher/schedule:
    get:
      tags:
        - 'Teacher - Schedule'
      summary: 'Haftalik dars jadvali'
      description: "Joriy hafta uchun to'liq dars jadvali"
      x-permissions:
        - teacher.schedule.view
        - admin.schedule.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
        - dean
      x-user-types:
        - employee
      responses:
        200:
          description: 'Haftalik jadval'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { type: array, items: { $ref: '#/components/schemas/ScheduleItem' } }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /v1/teacher/schedule/workload:
    get:
      tags:
        - 'Teacher - Schedule'
      summary: "O'qituvchi ish yuki"
      description: "O'qituvchining umumiy ish yuki (soatlar, fanlar, guruhlar)"
      x-permissions:
        - teacher.schedule.view
        - admin.schedule.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
        - dean
      x-user-types:
        - employee
      responses:
        200:
          description: "Ish yuki ma'lumotlari"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { $ref: '#/components/schemas/WorkloadData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /v1/teacher/subjects:
    get:
      tags:
        - 'Teacher - Subjects'
      summary: "O'qitiladigan fanlar"
      x-permissions:
        - teacher.subjects.view
        - admin.subjects.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      responses:
        200:
          description: "Fanlar ro'yxati"
  /v1/teacher/students:
    get:
      tags:
        - 'Teacher - Students'
      summary: "Talabalar ro'yxati"
      x-permissions:
        - teacher.students.view
        - admin.students.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
        - dean
      x-user-types:
        - employee
      parameters:
        -
          name: group_id
          in: query
          schema:
            type: integer
        -
          name: subject_id
          in: query
          schema:
            type: integer
      responses:
        200:
          description: "Talabalar ro'yxati"
  /v1/teacher/attendance:
    get:
      tags:
        - 'Teacher - Attendance'
      summary: "Davomat ro'yxati"
      description: "Hamma darslar uchun davomat ma'lumotlari (Davomat qilinmagan darslarni ham ko'rsatadi)"
      x-permissions:
        - teacher.attendance.view
        - admin.attendance.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      responses:
        200:
          description: "Davomat ro'yxati (qilingan va qilinmagan darslar)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { type: array, items: { $ref: '#/components/schemas/AttendanceData' } }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - 'Teacher - Attendance'
      summary: 'Davomat belgilash'
      description: 'Dars uchun talabalar davomatini belgilash'
      x-permissions:
        - teacher.attendance.mark
        - admin.attendance.mark
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceRequest'
            example:
              subject_schedule_id: 1234
              date: '2025-01-04'
              attendance:
                -
                  student_id: 5678
                  status: 1
                -
                  student_id: 5679
                  status: 2
                -
                  student_id: 5680
                  status: 3
                  reason: Kasallik
      responses:
        200:
          description: 'Davomat saqlandi'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: 'Davomat muvaffaqiyatli saqlandi' }
                  data: { $ref: '#/components/schemas/AttendanceData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        422:
          $ref: '#/components/responses/ValidationError'
  '/v1/teacher/attendance/{scheduleId}':
    get:
      tags:
        - 'Teacher - Attendance'
      summary: 'Bitta dars uchun davomat'
      description: "Ma'lum bir dars (schedule) uchun davomat ma'lumotlarini ko'rish"
      x-permissions:
        - teacher.attendance.view
        - admin.attendance.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      parameters:
        -
          name: scheduleId
          in: path
          required: true
          description: 'Dars jadvali ID'
          schema:
            type: integer
            example: 1234
      responses:
        200:
          description: "Dars uchun davomat ma'lumotlari"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { $ref: '#/components/schemas/AttendanceData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          $ref: '#/components/responses/NotFoundError'
  '/v1/teacher/attendance/{id}':
    put:
      tags:
        - 'Teacher - Attendance'
      summary: 'Davomat yangilash'
      description: 'Mavjud davomat yozuvini yangilash (tuzatish)'
      x-permissions:
        - teacher.attendance.mark
        - admin.attendance.mark
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      parameters:
        -
          name: id
          in: path
          required: true
          description: 'Davomat yozuvi ID'
          schema:
            type: integer
            example: 9876
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceRequest'
            example:
              subject_schedule_id: 1234
              date: '2025-01-04'
              attendance:
                -
                  student_id: 5678
                  status: 1
                -
                  student_id: 5679
                  status: 3
                  reason: "Shifokor ma'lumotnomasi"
      responses:
        200:
          description: 'Davomat yangilandi'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: 'Davomat muvaffaqiyatli yangilandi' }
                  data: { $ref: '#/components/schemas/AttendanceData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          $ref: '#/components/responses/NotFoundError'
        422:
          $ref: '#/components/responses/ValidationError'
  /v1/teacher/grades:
    get:
      tags:
        - 'Teacher - Grades'
      summary: "Baholar ro'yxati"
      description: "O'qituvchi qo'ygan barcha baholar ro'yxati"
      x-permissions:
        - teacher.grades.view
        - admin.grades.view
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      responses:
        200:
          description: Baholar
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data: { type: array, items: { $ref: '#/components/schemas/GradeData' } }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - 'Teacher - Grades'
      summary: "Baho qo'yish"
      description: "Talabaga yangi baho qo'yish"
      x-permissions:
        - teacher.grades.submit
        - admin.grades.submit
      x-roles:
        - teacher
        - senior_teacher
        - admin
      x-user-types:
        - employee
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GradeRequest'
            example:
              student_id: 5678
              subject_id: 123
              grade_type: midterm
              grade: 85.5
              comment: 'Yaxshi ishladi'
      responses:
        200:
          description: 'Baho saqlandi'
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: 'Baho muvaffaqiyatli saqlandi' }
                  data: { $ref: '#/components/schemas/GradeData' }
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        422:
          $ref: '#/components/responses/ValidationError'
  /v1/student/dashboard:
    get:
      tags:
        - 'Student - Dashboard'
      summary: 'Talaba dashboard'
      x-permissions:
        - student.dashboard.view
        - admin.student.view
      x-roles:
        - student
        - graduate_student
        - admin
      x-user-types:
        - student
        - employee
      responses:
        200:
          description: "Dashboard ma'lumotlari"
  /v1/admin/dashboard:
    get:
      tags:
        - 'Admin - Dashboard'
      summary: 'Admin dashboard'
      x-permissions:
        - admin.dashboard.view
        - superadmin.dashboard.view
      x-roles:
        - admin
        - superadmin
        - rector
        - dean
      x-user-types:
        - employee
      responses:
        200:
          description: Dashboard
  /v1/admin/users:
    get:
      tags:
        - 'Admin - Users'
      summary: "Foydalanuvchilar ro'yxati"
      x-permissions:
        - admin.users.view
        - superadmin.users.view
      x-roles:
        - admin
        - superadmin
        - hr_manager
      x-user-types:
        - employee
      responses:
        200:
          description: Users
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'JWT token authentication'
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: 'API Key for integration'
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: 'Operation completed successfully'
        data:
          type: object
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: 'Error message'
        errors:
          type: object
    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        last_page:
          type: integer
          example: 10
        per_page:
          type: integer
          example: 20
        total:
          type: integer
          example: 195
    DashboardData:
      type: object
      properties:
        stats:
          type: object
          properties:
            total_subjects:
              type: integer
              example: 5
              description: "O'qitiladigan fanlar soni"
            total_groups:
              type: integer
              example: 8
              description: 'Guruhlar soni'
            total_students:
              type: integer
              example: 142
              description: 'Talabalar soni'
            pending_attendance:
              type: integer
              example: 3
              description: 'Davomat qilinmagan darslar'
            ungraded_assignments:
              type: integer
              example: 12
              description: 'Baholanmagan topshiriqlar'
        today_schedule:
          type: array
          items:
            $ref: '#/components/schemas/ScheduleItem'
        pending_attendance_classes:
          type: array
          items:
            $ref: '#/components/schemas/PendingAttendanceClass'
        recent_activities:
          type: array
          items:
            $ref: '#/components/schemas/Activity'
    PendingAttendanceClass:
      type: object
      properties:
        id:
          type: integer
          example: 1234
        lesson_date:
          type: string
          format: date
          example: '2025-01-02'
        days_ago:
          type: integer
          example: 2
        subject_name:
          type: string
          example: Matematika
        group_name:
          type: string
          example: 21-guruh
        lesson_pair:
          type: integer
          example: 3
        audience:
          type: string
          example: A-201
    Activity:
      type: object
      properties:
        type:
          type: string
          enum:
            - attendance
            - grade
            - assignment
          example: attendance
        date:
          type: string
          format: date-time
          example: '2025-01-04T10:30:00Z'
        description:
          type: string
          example: 'Davomat belgilandi - Matematika, 21-guruh'
        student:
          type: string
          example: 'Aliyev Vali'
    ScheduleItem:
      type: object
      properties:
        id:
          type: integer
          example: 5678
        lesson_date:
          type: string
          format: date
          example: '2025-01-04'
        lesson_pair:
          type: integer
          example: 2
          description: 'Dars jufti (1-6)'
        start_time:
          type: string
          example: '09:00'
        end_time:
          type: string
          example: '10:30'
        subject:
          $ref: '#/components/schemas/Subject'
        group:
          $ref: '#/components/schemas/Group'
        audience:
          type: string
          example: A-301
        lesson_type:
          type: string
          enum:
            - lecture
            - practical
            - laboratory
            - seminar
          example: lecture
        has_attendance:
          type: boolean
          example: false
    WorkloadData:
      type: object
      properties:
        total_hours:
          type: integer
          example: 360
          description: 'Jami soatlar'
        completed_hours:
          type: integer
          example: 120
          description: "O'tilgan soatlar"
        remaining_hours:
          type: integer
          example: 240
        subjects:
          type: array
          items:
            type: object
            properties:
              subject_name:
                type: string
                example: Matematika
              total_hours:
                type: integer
                example: 72
              completed_hours:
                type: integer
                example: 24
              groups:
                type: array
                items:
                  type: string
                example:
                  - 21-guruh
                  - 22-guruh
    AttendanceRequest:
      type: object
      required:
        - subject_schedule_id
        - date
        - attendance
      properties:
        subject_schedule_id:
          type: integer
          example: 1234
          description: 'Dars jadvali ID'
        date:
          type: string
          format: date
          example: '2025-01-04'
        attendance:
          type: array
          items:
            type: object
            required:
              - student_id
              - status
            properties:
              student_id:
                type: integer
                example: 5678
              status:
                type: integer
                enum:
                  - 1
                  - 2
                  - 3
                example: 1
                description: '1=Keldi, 2=Kelmadi, 3=Sababli'
              reason:
                type: string
                example: Kasallik
                description: 'Sabab (agar status=3)'
    AttendanceData:
      type: object
      properties:
        id:
          type: integer
          example: 9876
        subject_schedule_id:
          type: integer
          example: 1234
        lesson_date:
          type: string
          format: date
          example: '2025-01-04'
        subject:
          $ref: '#/components/schemas/Subject'
        group:
          $ref: '#/components/schemas/Group'
        students:
          type: array
          items:
            type: object
            properties:
              student_id:
                type: integer
                example: 5678
              student_name:
                type: string
                example: 'Aliyev Vali'
              status:
                type: integer
                example: 1
              reason:
                type: string
                example: Kasallik
    GradeRequest:
      type: object
      required:
        - student_id
        - subject_id
        - grade_type
        - grade
      properties:
        student_id:
          type: integer
          example: 5678
        subject_id:
          type: integer
          example: 123
        grade_type:
          type: string
          enum:
            - current
            - midterm
            - final
            - attendance
          example: midterm
          description: 'Baho turi'
        grade:
          type: number
          format: float
          example: 85.5
          minimum: 0
          maximum: 100
        comment:
          type: string
          example: 'Yaxshi ishladi'
    GradeData:
      type: object
      properties:
        id:
          type: integer
          example: 4567
        student:
          $ref: '#/components/schemas/Student'
        subject:
          $ref: '#/components/schemas/Subject'
        grade_type:
          type: string
          example: midterm
        grade:
          type: number
          example: 85.5
        max_grade:
          type: number
          example: 100
        comment:
          type: string
          example: 'Yaxshi ishladi'
        created_at:
          type: string
          format: date-time
          example: '2025-01-04T14:30:00Z'
    Subject:
      type: object
      properties:
        id:
          type: integer
          example: 123
        name:
          type: string
          example: Matematika
        code:
          type: string
          example: MATH-101
        credit:
          type: integer
          example: 4
        semester:
          type: integer
          example: 2
    Group:
      type: object
      properties:
        id:
          type: integer
          example: 456
        name:
          type: string
          example: 21-guruh
        code:
          type: string
          example: IT-21-01
        course:
          type: integer
          example: 2
        students_count:
          type: integer
          example: 28
    Student:
      type: object
      properties:
        id:
          type: integer
          example: 5678
        full_name:
          type: string
          example: 'Aliyev Vali'
        student_id_number:
          type: string
          example: '2021001234'
        group:
          $ref: '#/components/schemas/Group'
        phone:
          type: string
          example: '+998901234567'
        email:
          type: string
          example: v.aliyev@student.uz
  responses:
    UnauthorizedError:
      description: "Token yo'q yoki yaroqsiz"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: 'Unauthenticated - Token not provided or invalid'
    ForbiddenError:
      description: "Ruxsat yo'q"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Forbidden - You don't have permission to access this resource"
    NotFoundError:
      description: "Ma'lumot topilmadi"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: 'Resource not found'
    ValidationError:
      description: 'Validatsiya xatosi'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: 'Validation failed'
            errors:
              student_id:
                - 'The student_id field is required'
              grade:
                - 'The grade must be between 0 and 100'
